'use strict';Object.defineProperty(exports,'__esModule',{value:true});exports.bearerToToken=exports.verifyToken=exports.getToken=undefined;var _slicedToArray=function(){function sliceIterator(arr,i){var _arr=[];var _n=true;var _d=false;var _e=undefined;try{for(var _i=arr[Symbol.iterator](),_s;!(_n=(_s=_i.next()).done);_n=true){_arr.push(_s.value);if(i&&_arr.length===i)break}}catch(err){_d=true;_e=err}finally{try{if(!_n&&_i['return'])_i['return']()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr)){return arr}else if(Symbol.iterator in Object(arr)){return sliceIterator(arr,i)}else{throw new TypeError('Invalid attempt to destructure non-iterable instance')}}}();var _getToken;var _koaJwt=require('koa-jwt');var _koaJwt2=_interopRequireDefault(_koaJwt);var _boom=require('boom');var _boom2=_interopRequireDefault(_boom);var _config=require('../config');var _config2=_interopRequireDefault(_config);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}function _defineProperty(obj,key,value){if(key in obj){Object.defineProperty(obj,key,{value:value,enumerable:true,configurable:true,writable:true})}else{obj[key]=value}return obj}var getToken=exports.getToken=(_getToken={},_defineProperty(_getToken,'JWT',function JWT(userInfo){return _koaJwt2.default.sign(userInfo,_config2.default.jwt.jwtSecret,{algorithm:'HS512',expiresIn:_config2.default.jwt.jwtTokenExpiresIn})}),_defineProperty(_getToken,'EMAIL',function EMAIL(email){return _koaJwt2.default.sign({email:email},_config2.default.jwt.jwtSecret,{algorithm:'HS256',expiresIn:_config2.default.jwt.emailTokenExpiresIn})}),_getToken);var verifyToken=exports.verifyToken=function verifyToken(token){return new Promise(function(resolve,reject){_koaJwt2.default.verify(token,_config2.default.jwt.jwtSecret,function(err,decoded){if(err){var TokenError=_boom2.default.unauthorized('Token is not valid or expired');return reject(TokenError)}resolve(decoded)})})};var bearerToToken=exports.bearerToToken=function bearerToToken(authorization){var parts=authorization.split(' ');if(parts.length===2){var _parts=_slicedToArray(parts,2),schema=_parts[0],credential=_parts[1];if(/^Bearer$/i.test(schema)){return credential}}};